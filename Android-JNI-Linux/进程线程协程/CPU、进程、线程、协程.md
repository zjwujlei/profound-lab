CPU、进程、线程、协程
=============

###CPU
CPU处理器，我们一般会说几核几线程。这里说的几核是指多少个物理核。几线程是指通过超线程技术（HT）将物理核虚拟成的逻辑处理单元个数，基本是物理核的两倍，例如4核8线程。

当然，通过HT技术实现单个物理核基于线程级别的并行计算其性能是比不上对于个数的物理和的。

说道CPU执行多个任务，我们是用的是并行，并行是指多核CPU在同一时间里执行多个任务。这里是真正意义上个的同时执行。和多线程并发有本质上的区别。

这里说的8线程和我们开发是用过到的线程（Thread）有一定的关系，但不等同。我们说的8线程其实是指8个虚拟核，可以认为是同时执行8个Thread（并行）。线程是最小的任务执行单元（具体在后面展开），通过对CPU时间的切片（一般是毫秒级别的），每个时间切片执行不同的线程来达到同时执行多个Thread的效果（并发）。

### 进程
进程是操作系统对CPU、内存、磁盘等资源分配的最小单元。

进程间是互相独立互不影响的，操作系统会为每个进程分配独立的内存地址空间（4GB，内存地址相关在《Android高效数据存储-mmap》中有学习到）。进程间通信需要使用IPC通信机制，通过内核态切换实现。

对于进程，在系统资源紧张时会根据进程优先级（1，前台进程、2，可视进程、3，次要服务进程、4，后台进程、5，内容供给节点（Content_Provider）、6，空进程）进行回收。这也恰巧验证了进程是资源分配的最小单元。

### 线程
线程是进程运行和执行的最小调度单元。一个进程中我们可以开启很多的线程。线程相对于进程来说十分轻量级，一个标准的线程有线程ID，当前指令指针，寄存器和堆栈组成。线程不拥有系统资源，大概占1M的运行必不可少的资源。

同时线程的调度是通过终端阻塞实现的，在线程的切换是需要将当前线程的现场资源，从缓存中读取目标线程的信息进行恢复。

同一进程中的各个线程共享该进程所拥有的资源，所有线程都具有相同的地址空间（进程的地址空间），这意味着，线程可以访问该地址空间的每一个虚地址；此外，还可以访问进程所拥有的已打开文件、定时器、信号量机构等。由于同一个进程内的线程共享内存和文件，所以线程之间互相通信不必调用内核。

### 协程

线程虽然相对于进程来说十分轻量级。但线程还是有一些缺点，例如线程不好管理，频繁创建线程会有内存问题。同时线程在中断、等待等情况下，线程是空闲的，没有很好的使用这段空闲时间。

协程是一种并发设计模式，您可以在 Android 平台上使用它来简化异步执行的代码，协程通过Continuation的resumeWith来替代线程异步是的callback回调，使用近似同步的编码方式实现异步。协程可以认为是一个特殊的函数，这个函数可以在某个地方挂起，在特定的时机又可以重新在挂起处继续运行。协程不是由操作系统内核所管理的，完全由程序所控制，这样在切换的时候就不涉及到用户态和内核态的切换，更加高效。同样因为协程只是一个函数，因此无法像线程一样的并发，协程在其指定的线程中完全是串行的，协程实现的并发并没有线程切换，只是通过函数。
